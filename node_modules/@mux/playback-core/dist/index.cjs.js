"use strict";var wt=Object.create;var B=Object.defineProperty;var Ot=Object.getOwnPropertyDescriptor;var Ut=Object.getOwnPropertyNames;var Ht=Object.getPrototypeOf,Vt=Object.prototype.hasOwnProperty;var Kt=(e,t)=>{for(var r in t)B(e,r,{get:t[r],enumerable:!0})},_e=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ut(t))!Vt.call(e,n)&&n!==r&&B(e,n,{get:()=>t[n],enumerable:!(o=Ot(t,n))||o.enumerable});return e};var ke=(e,t,r)=>(r=e!=null?wt(Ht(e)):{},_e(t||!e||!e.__esModule?B(r,"default",{value:e,enumerable:!0}):r,e)),Wt=e=>_e(B({},"__esModule",{value:!0}),e);var gr={};Kt(gr,{AutoplayTypes:()=>H,CmcdTypeValues:()=>Ft,CmcdTypes:()=>S,ExtensionMimeTypeMap:()=>N,Hls:()=>E,MaxResolution:()=>jt,MediaError:()=>f,MimeTypeShorthandMap:()=>V,MinResolution:()=>Jt,MuxErrorCategory:()=>C,MuxErrorCode:()=>D,MuxJWTAud:()=>Q,PlaybackTypes:()=>j,RenditionOrder:()=>Gt,StreamTypes:()=>_,addChapters:()=>fe,addCuePoints:()=>ue,addTextTrack:()=>z,allMediaTypes:()=>Bt,errorCategoryToTokenNameOrPrefix:()=>U,fetchAndDispatchMuxMetadata:()=>te,generatePlayerInitTime:()=>ur,generateUUID:()=>gt,getActiveChapter:()=>Te,getActiveCuePoint:()=>de,getAppCertificate:()=>kt,getChapters:()=>je,getCuePoints:()=>$e,getCurrentPdt:()=>Ge,getDRMConfig:()=>_t,getEnded:()=>bt,getError:()=>Mt,getLicenseKey:()=>ht,getLiveEdgeStart:()=>Tr,getMediaPlaylistFromMultivariantPlaylist:()=>ut,getMetadata:()=>pr,getMultivariantPlaylistSessionData:()=>dt,getSeekable:()=>xe,getStartDate:()=>Je,getStreamInfoFromHlsjsLevelDetails:()=>yt,getStreamInfoFromPlaylist:()=>pt,getStreamInfoFromSrcAndType:()=>ft,getStreamType:()=>Ee,getStreamTypeConfig:()=>Pt,getTargetLiveWindow:()=>fr,getTextTrack:()=>w,i18n:()=>M,initialize:()=>mr,isKeyOf:()=>O,isMuxVideoSrc:()=>Ce,isPseudoEnded:()=>Rt,isStuckOnLastFragment:()=>be,loadMedia:()=>It,mux:()=>$.default,muxMediaState:()=>P,parseJwt:()=>G,parseTagAttributes:()=>lt,removeTextTrack:()=>We,setupChapters:()=>ye,setupCuePoints:()=>le,setupHls:()=>vt,setupMux:()=>Nt,setupNativeFairplayDRM:()=>Lt,shorthandKeys:()=>$t,teardown:()=>Dt,toAppCertURL:()=>De,toDRMTypeFromKeySystem:()=>ct,toLicenseKeyURL:()=>F,toMuxVideoURL:()=>dr,toPlaybackIdFromSrc:()=>Me,toPlaybackIdParts:()=>K,updateStreamInfoFromHlsjsLevelDetails:()=>mt,updateStreamInfoFromSrc:()=>Tt});module.exports=Wt(gr);var $=ke(require("mux-embed"));var he=ke(require("hls.js")),E=he.default;var C={VIDEO:"video",THUMBNAIL:"thumbnail",STORYBOARD:"storyboard",DRM:"drm"},D={NOT_AN_ERROR:0,NETWORK_OFFLINE:2000002,NETWORK_UNKNOWN_ERROR:2e6,NETWORK_NO_STATUS:2000001,NETWORK_INVALID_URL:24e5,NETWORK_NOT_FOUND:2404e3,NETWORK_NOT_READY:2412e3,NETWORK_GENERIC_SERVER_FAIL:25e5,NETWORK_TOKEN_MISSING:2403201,NETWORK_TOKEN_MALFORMED:2412202,NETWORK_TOKEN_EXPIRED:2403210,NETWORK_TOKEN_AUD_MISSING:2403221,NETWORK_TOKEN_AUD_MISMATCH:2403222,NETWORK_TOKEN_SUB_MISMATCH:2403232,ENCRYPTED_ERROR:5e6,ENCRYPTED_UNSUPPORTED_KEY_SYSTEM:5000001,ENCRYPTED_GENERATE_REQUEST_FAILED:5000002,ENCRYPTED_UPDATE_LICENSE_FAILED:5000003,ENCRYPTED_UPDATE_SERVER_CERT_FAILED:5000004,ENCRYPTED_CDM_ERROR:5000005,ENCRYPTED_OUTPUT_RESTRICTED:5000006,ENCRYPTED_MISSING_TOKEN:5000002},U=e=>e===C.VIDEO?"playback":e,L=class L extends Error{constructor(t,r=L.MEDIA_ERR_CUSTOM,o,n){var s;super(t),this.name="MediaError",this.code=r,this.context=n,this.fatal=o!=null?o:r>=L.MEDIA_ERR_NETWORK&&r<=L.MEDIA_ERR_ENCRYPTED,this.message||(this.message=(s=L.defaultMessages[this.code])!=null?s:"")}};L.MEDIA_ERR_ABORTED=1,L.MEDIA_ERR_NETWORK=2,L.MEDIA_ERR_DECODE=3,L.MEDIA_ERR_SRC_NOT_SUPPORTED=4,L.MEDIA_ERR_ENCRYPTED=5,L.MEDIA_ERR_CUSTOM=100,L.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var f=L;var Yt=e=>e==null,O=(e,t)=>Yt(t)?!1:e in t,H={ANY:"any",MUTED:"muted"},_={ON_DEMAND:"on-demand",LIVE:"live",UNKNOWN:"unknown"},j={MSE:"mse",NATIVE:"native"},S={HEADER:"header",QUERY:"query",NONE:"none"},Ft=Object.values(S),N={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},V={HLS:N.M3U8},$t=Object.keys(V),Bt=[...Object.values(N),"hls","HLS"],jt={upTo720p:"720p",upTo1080p:"1080p",upTo1440p:"1440p",upTo2160p:"2160p"},Jt={noLessThan480p:"480p",noLessThan540p:"540p",noLessThan720p:"720p",noLessThan1080p:"1080p",noLessThan1440p:"1440p",noLessThan2160p:"2160p"},Gt={DESCENDING:"desc"};var qt="en",J={code:qt};var v=(e,t,r,o,n=e)=>{n.addEventListener(t,r,o),e.addEventListener("teardown",()=>{n.removeEventListener(t,r)},{once:!0})};function Le(e,t,r){t&&r>t&&(r=t);for(let o=0;o<e.length;o++)if(e.start(o)<=r&&e.end(o)>=r)return!0;return!1}var K=e=>{let t=e.indexOf("?");if(t<0)return[e];let r=e.slice(0,t),o=e.slice(t);return[r,o]},W=e=>{let{type:t}=e;if(t){let r=t.toUpperCase();return O(r,V)?V[r]:t}return Xt(e)},oe=e=>e==="VOD"?_.ON_DEMAND:_.LIVE,ae=e=>e==="EVENT"?Number.POSITIVE_INFINITY:e==="VOD"?Number.NaN:0,Xt=e=>{let{src:t}=e;if(!t)return"";let r="";try{r=new URL(t).pathname}catch{console.error("invalid url")}let o=r.lastIndexOf(".");if(o<0)return Qt(e)?N.M3U8:"";let s=r.slice(o+1).toUpperCase();return O(s,N)?N[s]:""},zt="mux.com",Qt=({src:e,customDomain:t=zt})=>{let r;try{r=new URL(`${e}`)}catch{return!1}let o=r.protocol==="https:",n=r.hostname===`stream.${t}`.toLowerCase(),s=r.pathname.split("/"),a=s.length===2,i=!(s!=null&&s[1].includes("."));return o&&n&&a&&i},G=e=>{let t=(e!=null?e:"").split(".")[1];if(t)try{let r=t.replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(r).split("").map(function(n){return"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(o)}catch{return}},Ne=({exp:e},t=Date.now())=>!e||e*1e3<t,Ie=({sub:e},t)=>e!==t,Ae=({aud:e},t)=>!e,Se=({aud:e},t)=>e!==t,we="en";function M(e,t=!0){var n,s;let r=t&&(s=(n=J)==null?void 0:n[e])!=null?s:e,o=t?J.code:we;return new ne(r,o)}var ne=class{constructor(t,r=(o=>(o=J)!=null?o:we)()){this.message=t,this.locale=r}format(t){return this.message.replace(/\{(\w+)\}/g,(r,o)=>{var n;return(n=t[o])!=null?n:""})}toString(){return this.message}};var Zt=Object.values(H),Oe=e=>typeof e=="boolean"||typeof e=="string"&&Zt.includes(e),Ue=(e,t,r)=>{let{autoplay:o}=e,n=!1,s=!1,a=Oe(o)?o:!!o,i=()=>{n||v(t,"playing",()=>{n=!0},{once:!0})};if(i(),v(t,"loadstart",()=>{n=!1,i(),se(t,a)},{once:!0}),v(t,"loadstart",()=>{r||(e.streamType&&e.streamType!==_.UNKNOWN?s=e.streamType===_.LIVE:s=!Number.isFinite(t.duration)),se(t,a)},{once:!0}),r&&r.once(E.Events.LEVEL_LOADED,(u,c)=>{var d;e.streamType&&e.streamType!==_.UNKNOWN?s=e.streamType===_.LIVE:s=(d=c.details.live)!=null?d:!1}),!a){let u=()=>{!s||Number.isFinite(e.startTime)||(r!=null&&r.liveSyncPosition?t.currentTime=r.liveSyncPosition:Number.isFinite(t.seekable.end(0))&&(t.currentTime=t.seekable.end(0)))};r&&v(t,"play",()=>{t.preload==="metadata"?r.once(E.Events.LEVEL_UPDATED,u):u()},{once:!0})}return u=>{n||(a=Oe(u)?u:!!u,se(t,a))}},se=(e,t)=>{if(!t)return;let r=e.muted,o=()=>e.muted=r;switch(t){case H.ANY:e.play().catch(()=>{e.muted=!0,e.play().catch(o)});break;case H.MUTED:e.muted=!0,e.play().catch(o);break;default:e.play().catch(()=>{});break}};var He=({preload:e,src:t},r,o)=>{let n=d=>{d!=null&&["","none","metadata","auto"].includes(d)?r.setAttribute("preload",d):r.removeAttribute("preload")};if(!o)return n(e),n;let s=!1,a=!1,i=o.config.maxBufferLength,l=o.config.maxBufferSize,u=d=>{n(d);let p=d!=null?d:r.preload;a||p==="none"||(p==="metadata"?(o.config.maxBufferLength=1,o.config.maxBufferSize=1):(o.config.maxBufferLength=i,o.config.maxBufferSize=l),c())},c=()=>{!s&&t&&(s=!0,o.loadSource(t))};return v(r,"play",()=>{a=!0,o.config.maxBufferLength=i,o.config.maxBufferSize=l,c()},{once:!0}),u(e),u};function Ve(e,t){var i;if(!("videoTracks"in e))return;let r=new WeakMap;t.on(E.Events.MANIFEST_PARSED,function(l,u){a();let c=e.addVideoTrack("main");c.selected=!0;for(let[d,p]of u.levels.entries()){let T=c.addRendition(p.url[0],p.width,p.height,p.videoCodec,p.bitrate);r.set(p,`${d}`),T.id=`${d}`}}),t.on(E.Events.AUDIO_TRACKS_UPDATED,function(l,u){s();for(let c of u.audioTracks){let d=c.default?"main":"alternative",p=e.addAudioTrack(d,c.name,c.lang);p.id=`${c.id}`,c.default&&(p.enabled=!0)}}),e.audioTracks.addEventListener("change",()=>{var c;let l=+((c=[...e.audioTracks].find(d=>d.enabled))==null?void 0:c.id),u=t.audioTracks.map(d=>d.id);l!=t.audioTrack&&u.includes(l)&&(t.audioTrack=l)}),t.on(E.Events.LEVELS_UPDATED,function(l,u){var p;let c=e.videoTracks[(p=e.videoTracks.selectedIndex)!=null?p:0];if(!c)return;let d=u.levels.map(T=>r.get(T));for(let T of e.videoRenditions)T.id&&!d.includes(T.id)&&c.removeRendition(T)});let o=l=>{let u=l.target.selectedIndex;u!=t.nextLevel&&(t.nextLevel=u)};(i=e.videoRenditions)==null||i.addEventListener("change",o);let n=()=>{for(let l of e.videoTracks)e.removeVideoTrack(l)},s=()=>{for(let l of e.audioTracks)e.removeAudioTrack(l)},a=()=>{n(),s()};t.once(E.Events.DESTROYING,a)}var ie=e=>"time"in e?e.time:e.startTime;function Ke(e,t){t.on(E.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(n,{tracks:s})=>{s.forEach(a=>{var c,d;let i=(c=a.subtitleTrack)!=null?c:a.closedCaptions,l=t.subtitleTracks.findIndex(({lang:p,name:T,type:m})=>p==(i==null?void 0:i.lang)&&T===a.label&&m.toLowerCase()===a.kind),u=((d=a._id)!=null?d:a.default)?"default":`${a.kind}${l}`;z(e,a.kind,a.label,i==null?void 0:i.lang,u,a.default)})});let r=()=>{if(!t.subtitleTracks.length)return;let n=Array.from(e.textTracks).find(i=>i.id&&i.mode==="showing"&&["subtitles","captions"].includes(i.kind));if(!n)return;let s=t.subtitleTracks[t.subtitleTrack],a=s?s.default?"default":`${t.subtitleTracks[t.subtitleTrack].type.toLowerCase()}${t.subtitleTrack}`:void 0;if(t.subtitleTrack<0||(n==null?void 0:n.id)!==a){let i=t.subtitleTracks.findIndex(({lang:l,name:u,type:c,default:d})=>n.id==="default"&&d||l==n.language&&u===n.label&&c.toLowerCase()===n.kind);t.subtitleTrack=i}(n==null?void 0:n.id)===a&&n.cues&&Array.from(n.cues).forEach(i=>{n.addCue(i)})};e.textTracks.addEventListener("change",r),t.on(E.Events.CUES_PARSED,(n,{track:s,cues:a})=>{let i=e.textTracks.getTrackById(s);if(!i)return;let l=i.mode==="disabled";l&&(i.mode="hidden"),a.forEach(u=>{var c;(c=i.cues)!=null&&c.getCueById(u.id)||i.addCue(u)}),l&&(i.mode="disabled")}),t.once(E.Events.DESTROYING,()=>{e.textTracks.removeEventListener("change",r),e.querySelectorAll("track[data-removeondestroy]").forEach(s=>{s.remove()})});let o=()=>{Array.from(e.textTracks).forEach(n=>{var s,a;if(!["subtitles","caption"].includes(n.kind)&&(n.label==="thumbnails"||n.kind==="chapters")){if(!((s=n.cues)!=null&&s.length)){let i="track";n.kind&&(i+=`[kind="${n.kind}"]`),n.label&&(i+=`[label="${n.label}"]`);let l=e.querySelector(i),u=(a=l==null?void 0:l.getAttribute("src"))!=null?a:"";l==null||l.removeAttribute("src"),setTimeout(()=>{l==null||l.setAttribute("src",u)},0)}n.mode!=="hidden"&&(n.mode="hidden")}})};t.once(E.Events.MANIFEST_LOADED,o),t.once(E.Events.MEDIA_ATTACHED,o)}function z(e,t,r,o,n,s){let a=document.createElement("track");return a.kind=t,a.label=r,o&&(a.srclang=o),n&&(a.id=n),s&&(a.default=!0),a.track.mode=["subtitles","captions"].includes(t)?"disabled":"hidden",a.setAttribute("data-removeondestroy",""),e.append(a),a.track}function We(e,t){let r=Array.prototype.find.call(e.querySelectorAll("track"),o=>o.track===t);r==null||r.remove()}function w(e,t,r){var o;return(o=Array.from(e.querySelectorAll("track")).find(n=>n.track.label===t&&n.track.kind===r))==null?void 0:o.track}async function Ye(e,t,r,o){let n=w(e,r,o);return n||(n=z(e,o,r),n.mode="hidden",await new Promise(s=>setTimeout(()=>s(void 0),0))),n.mode!=="hidden"&&(n.mode="hidden"),[...t].sort((s,a)=>ie(a)-ie(s)).forEach(s=>{var l,u;let a=s.value,i=ie(s);if("endTime"in s&&s.endTime!=null)n==null||n.addCue(new VTTCue(i,s.endTime,o==="chapters"?a:JSON.stringify(a!=null?a:null)));else{let c=Array.prototype.findIndex.call(n==null?void 0:n.cues,m=>m.startTime>=i),d=(l=n==null?void 0:n.cues)==null?void 0:l[c],p=d?d.startTime:Number.isFinite(e.duration)?e.duration:Number.MAX_SAFE_INTEGER,T=(u=n==null?void 0:n.cues)==null?void 0:u[c-1];T&&(T.endTime=i),n==null||n.addCue(new VTTCue(i,p,o==="chapters"?a:JSON.stringify(a!=null?a:null)))}}),e.textTracks.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})),n}var ce="cuepoints",Fe=Object.freeze({label:ce});async function ue(e,t,r=Fe){return Ye(e,t,r.label,"metadata")}var q=e=>({time:e.startTime,value:JSON.parse(e.text)});function $e(e,t={label:ce}){let r=w(e,t.label,"metadata");return r!=null&&r.cues?Array.from(r.cues,o=>q(o)):[]}function de(e,t={label:ce}){var s,a;let r=w(e,t.label,"metadata");if(!((s=r==null?void 0:r.activeCues)!=null&&s.length))return;if(r.activeCues.length===1)return q(r.activeCues[0]);let{currentTime:o}=e,n=Array.prototype.find.call((a=r.activeCues)!=null?a:[],({startTime:i,endTime:l})=>i<=o&&l>o);return q(n||r.activeCues[0])}async function le(e,t=Fe){return new Promise(r=>{v(e,"loadstart",async()=>{let o=await ue(e,[],t);v(e,"cuechange",()=>{let n=de(e);if(n){let s=new CustomEvent("cuepointchange",{composed:!0,bubbles:!0,detail:n});e.dispatchEvent(s)}},{},o),r(o)})})}var pe="chapters",Be=Object.freeze({label:pe}),X=e=>({startTime:e.startTime,endTime:e.endTime,value:e.text});async function fe(e,t,r=Be){return Ye(e,t,r.label,"chapters")}function je(e,t={label:pe}){var o;let r=w(e,t.label,"chapters");return(o=r==null?void 0:r.cues)!=null&&o.length?Array.from(r.cues,n=>X(n)):[]}function Te(e,t={label:pe}){var s,a;let r=w(e,t.label,"chapters");if(!((s=r==null?void 0:r.activeCues)!=null&&s.length))return;if(r.activeCues.length===1)return X(r.activeCues[0]);let{currentTime:o}=e,n=Array.prototype.find.call((a=r.activeCues)!=null?a:[],({startTime:i,endTime:l})=>i<=o&&l>o);return X(n||r.activeCues[0])}async function ye(e,t=Be){return new Promise(r=>{v(e,"loadstart",async()=>{let o=await fe(e,[],t);v(e,"cuechange",()=>{let n=Te(e);if(n){let s=new CustomEvent("chapterchange",{composed:!0,bubbles:!0,detail:n});e.dispatchEvent(s)}},{},o),r(o)})})}function Je(e,t){if(t){let r=t.playingDate;if(r!=null)return new Date(r.getTime()-e.currentTime*1e3)}return typeof e.getStartDate=="function"?e.getStartDate():new Date(NaN)}function Ge(e,t){if(t&&t.playingDate)return t.playingDate;if(typeof e.getStartDate=="function"){let r=e.getStartDate();return new Date(r.getTime()+e.currentTime*1e3)}return new Date(NaN)}var Q={VIDEO:"v",THUMBNAIL:"t",STORYBOARD:"s",DRM:"d"},er=e=>{if(e===C.VIDEO)return Q.VIDEO;if(e===C.DRM)return Q.DRM},tr=(e,t)=>{var n,s;let r=U(e),o=`${r}Token`;return(n=t.tokens)!=null&&n[r]?(s=t.tokens)==null?void 0:s[r]:O(o,t)?t[o]:void 0},Y=(e,t,r,o,n=!1,s=!(a=>(a=globalThis.navigator)==null?void 0:a.onLine)())=>{var x,h;if(s){let b=M("Your device appears to be offline",n),g=void 0,y=f.MEDIA_ERR_NETWORK,k=new f(b,y,!1,g);return k.errorCategory=t,k.muxCode=D.NETWORK_OFFLINE,k.data=e,k}let i="status"in e?e.status:e.code,l=Date.now(),u=f.MEDIA_ERR_NETWORK;if(i===200)return;let c=U(t),d=tr(t,r),p=er(t),[T]=K((x=r.playbackId)!=null?x:"");if(!i||!T)return;let m=G(d);if(d&&!m){let b=M("The {tokenNamePrefix}-token provided is invalid or malformed.",n).format({tokenNamePrefix:c}),g=M("Compact JWT string: {token}",n).format({token:d}),y=new f(b,u,!0,g);return y.errorCategory=t,y.muxCode=D.NETWORK_TOKEN_MALFORMED,y.data=e,y}if(i>=500){let b=new f("",u,o!=null?o:!0);return b.errorCategory=t,b.muxCode=D.NETWORK_UNKNOWN_ERROR,b}if(i===403)if(m){if(Ne(m,l)){let b={timeStyle:"medium",dateStyle:"medium"},g=M("The video\u2019s secured {tokenNamePrefix}-token has expired.",n).format({tokenNamePrefix:c}),y=M("Expired at: {expiredDate}. Current time: {currentDate}.",n).format({expiredDate:new Intl.DateTimeFormat("en",b).format((h=m.exp)!=null?h:0*1e3),currentDate:new Intl.DateTimeFormat("en",b).format(l)}),k=new f(g,u,!0,y);return k.errorCategory=t,k.muxCode=D.NETWORK_TOKEN_EXPIRED,k.data=e,k}if(Ie(m,T)){let b=M("The video\u2019s playback ID does not match the one encoded in the {tokenNamePrefix}-token.",n).format({tokenNamePrefix:c}),g=M("Specified playback ID: {playbackId} and the playback ID encoded in the {tokenNamePrefix}-token: {tokenPlaybackId}",n).format({tokenNamePrefix:c,playbackId:T,tokenPlaybackId:m.sub}),y=new f(b,u,!0,g);return y.errorCategory=t,y.muxCode=D.NETWORK_TOKEN_SUB_MISMATCH,y.data=e,y}if(Ae(m,p)){let b=M("The {tokenNamePrefix}-token is formatted with incorrect information.",n).format({tokenNamePrefix:c}),g=M("The {tokenNamePrefix}-token has no aud value. aud value should be {expectedAud}.",n).format({tokenNamePrefix:c,expectedAud:p}),y=new f(b,u,!0,g);return y.errorCategory=t,y.muxCode=D.NETWORK_TOKEN_AUD_MISSING,y.data=e,y}if(Se(m,p)){let b=M("The {tokenNamePrefix}-token is formatted with incorrect information.",n).format({tokenNamePrefix:c}),g=M("The {tokenNamePrefix}-token has an incorrect aud value: {aud}. aud value should be {expectedAud}.",n).format({tokenNamePrefix:c,expectedAud:p,aud:m.aud}),y=new f(b,u,!0,g);return y.errorCategory=t,y.muxCode=D.NETWORK_TOKEN_AUD_MISMATCH,y.data=e,y}}else{let b=M("Authorization error trying to access this {category} URL. If this is a signed URL, you might need to provide a {tokenNamePrefix}-token.",n).format({tokenNamePrefix:c,category:t}),g=M("Specified playback ID: {playbackId}",n).format({playbackId:T}),y=new f(b,u,o!=null?o:!0,g);return y.errorCategory=t,y.muxCode=D.NETWORK_TOKEN_MISSING,y.data=e,y}if(i===412){let b=M("This playback-id may belong to a live stream that is not currently active or an asset that is not ready.",n),g=M("Specified playback ID: {playbackId}",n).format({playbackId:T}),y=new f(b,u,o!=null?o:!0,g);return y.errorCategory=t,y.muxCode=D.NETWORK_NOT_READY,y.streamType=r.streamType===_.LIVE?"live":r.streamType===_.ON_DEMAND?"on-demand":"unknown",y.data=e,y}if(i===404){let b=M("This URL or playback-id does not exist. You may have used an Asset ID or an ID from a different resource.",n),g=M("Specified playback ID: {playbackId}",n).format({playbackId:T}),y=new f(b,u,o!=null?o:!0,g);return y.errorCategory=t,y.muxCode=D.NETWORK_NOT_FOUND,y.data=e,y}if(i===400){let b=M("The URL or playback-id was invalid. You may have used an invalid value as a playback-id."),g=M("Specified playback ID: {playbackId}",n).format({playbackId:T}),y=new f(b,u,o!=null?o:!0,g);return y.errorCategory=t,y.muxCode=D.NETWORK_INVALID_URL,y.data=e,y}let R=new f("",u,o!=null?o:!0);return R.errorCategory=t,R.muxCode=D.NETWORK_UNKNOWN_ERROR,R.data=e,R};var qe=E.DefaultConfig.capLevelController,Z=class Z extends qe{constructor(t){super(t)}get levels(){var t;return(t=this.hls.levels)!=null?t:[]}getValidLevels(t){return this.levels.filter((r,o)=>this.isLevelAllowed(r)&&o<=t)}getMaxLevel(t){let r=super.getMaxLevel(t),o=this.getValidLevels(t);if(!o[r])return r;let n=Math.min(o[r].width,o[r].height),s=Z.minMaxResolution;return n>=s?r:qe.getMaxLevelByMediaSize(o,s*(16/9),s)}};Z.minMaxResolution=720;var me=Z,Xe=me;var ee={FAIRPLAY:"fairplay",PLAYREADY:"playready",WIDEVINE:"widevine"},ct=e=>{if(e.includes("fps"))return ee.FAIRPLAY;if(e.includes("playready"))return ee.PLAYREADY;if(e.includes("widevine"))return ee.WIDEVINE},ut=e=>{let t=e.split(`
`).find((r,o,n)=>o&&n[o-1].startsWith("#EXT-X-STREAM-INF"));return fetch(t).then(r=>r.status!==200?Promise.reject(r):r.text())},dt=e=>{let t=e.split(`
`).filter(o=>o.startsWith("#EXT-X-SESSION-DATA"));if(!t.length)return{};let r={};for(let o of t){let n=lt(o),s=n["DATA-ID"];s&&(r[s]={...n})}return{sessionData:r}},rr=/([A-Z0-9-]+)="?(.*?)"?(?:,|$)/g;function lt(e){let t=[...e.matchAll(rr)];return Object.fromEntries(t.map(([,r,o])=>[r,o]))}var pt=e=>{var i,l,u;let t=e.split(`
`),o=(l=((i=t.find(c=>c.startsWith("#EXT-X-PLAYLIST-TYPE")))!=null?i:"").split(":")[1])==null?void 0:l.trim(),n=oe(o),s=ae(o),a;if(n===_.LIVE){let c=t.find(p=>p.startsWith("#EXT-X-PART-INF"));if(!!c)a=+c.split(":")[1].split("=")[1]*2;else{let p=t.find(R=>R.startsWith("#EXT-X-TARGETDURATION")),T=(u=p==null?void 0:p.split(":"))==null?void 0:u[1];a=+(T!=null?T:6)*3}}return{streamType:n,targetLiveWindow:s,liveEdgeStartOffset:a}},ft=async(e,t)=>{if(t===N.MP4)return{streamType:_.ON_DEMAND,targetLiveWindow:Number.NaN,liveEdgeStartOffset:void 0,sessionData:void 0};if(t===N.M3U8){let r=await fetch(e);if(!r.ok)return Promise.reject(r);let o=await r.text(),n=await ut(o);return{...dt(o),...pt(n)}}return console.error(`Media type ${t} is an unrecognized or unsupported type for src ${e}.`),{streamType:void 0,targetLiveWindow:void 0,liveEdgeStartOffset:void 0,sessionData:void 0}},Tt=async(e,t,r=W({src:e}))=>{var l,u,c,d;let{streamType:o,targetLiveWindow:n,liveEdgeStartOffset:s,sessionData:a}=await ft(e,r),i=a==null?void 0:a["com.apple.hls.chapters"];(i!=null&&i.URI||i!=null&&i.VALUE.toLocaleLowerCase().startsWith("http"))&&te((l=i.URI)!=null?l:i.VALUE,t),((u=P.get(t))!=null?u:{}).liveEdgeStartOffset=s,((c=P.get(t))!=null?c:{}).targetLiveWindow=n,t.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),((d=P.get(t))!=null?d:{}).streamType=o,t.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))},te=async(e,t)=>{var r,o;try{let n=await fetch(e);if(!n.ok)throw new Error(`Failed to fetch Mux metadata: ${n.status} ${n.statusText}`);let s=await n.json(),a={};if(!((r=s==null?void 0:s[0])!=null&&r.metadata))return;for(let l of s[0].metadata)l.key&&l.value&&(a[l.key]=l.value);((o=P.get(t))!=null?o:{}).metadata=a;let i=new CustomEvent("muxmetadata");t.dispatchEvent(i)}catch(n){console.error(n)}},yt=e=>{var a;let t=e.type,r=oe(t),o=ae(t),n,s=!!((a=e.partList)!=null&&a.length);return r===_.LIVE&&(n=s?e.partTarget*2:e.targetduration*3),{streamType:r,targetLiveWindow:o,liveEdgeStartOffset:n,lowLatency:s}},mt=(e,t,r)=>{var i,l,u,c,d,p,T,m;let{streamType:o,targetLiveWindow:n,liveEdgeStartOffset:s,lowLatency:a}=yt(e);if(o===_.LIVE){a?(r.config.backBufferLength=(i=r.userConfig.backBufferLength)!=null?i:4,r.config.maxFragLookUpTolerance=(l=r.userConfig.maxFragLookUpTolerance)!=null?l:.001,r.config.abrBandWidthUpFactor=(u=r.userConfig.abrBandWidthUpFactor)!=null?u:r.config.abrBandWidthFactor):r.config.backBufferLength=(c=r.userConfig.backBufferLength)!=null?c:8;let R=Object.freeze({get length(){return t.seekable.length},start(x){return t.seekable.start(x)},end(x){var h;return x>this.length||x<0||Number.isFinite(t.duration)?t.seekable.end(x):(h=r.liveSyncPosition)!=null?h:t.seekable.end(x)}});((d=P.get(t))!=null?d:{}).seekable=R}((p=P.get(t))!=null?p:{}).liveEdgeStartOffset=s,((T=P.get(t))!=null?T:{}).targetLiveWindow=n,t.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),((m=P.get(t))!=null?m:{}).streamType=o,t.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))},Qe,Ze,nr=(Ze=(Qe=globalThis==null?void 0:globalThis.navigator)==null?void 0:Qe.userAgent)!=null?Ze:"",et,tt,rt,or=(rt=(tt=(et=globalThis==null?void 0:globalThis.navigator)==null?void 0:et.userAgentData)==null?void 0:tt.platform)!=null?rt:"",nt,ot,at,ar=(at=(ot=(nt=globalThis==null?void 0:globalThis.navigator)==null?void 0:nt.userAgentData)==null?void 0:ot.brands)!=null?at:[],sr=nr.toLowerCase().includes("android")||["x11","android"].some(e=>or.toLowerCase().includes(e)),ze=ar.find(e=>e.brand==="Google Chrome"),ir=e=>{var t;return ze&&parseInt((t=ze.version)!=null?t:"0")>=141&&!!e.canPlayType("application/vnd.apple.mpegurl")},P=new WeakMap,A="mux.com",st,it,Et=(it=(st=E).isSupported)==null?void 0:it.call(st),cr=e=>sr||ir(e),ur=()=>$.default.utils.now(),gt=$.default.utils.generateUUID,dr=({playbackId:e,customDomain:t=A,maxResolution:r,minResolution:o,renditionOrder:n,programStartTime:s,programEndTime:a,assetStartTime:i,assetEndTime:l,playbackToken:u,tokens:{playback:c=u}={},extraSourceParams:d={}}={})=>{if(!e)return;let[p,T=""]=K(e),m=new URL(`https://stream.${t}/${p}.m3u8${T}`);return c||m.searchParams.has("token")?(m.searchParams.forEach((R,x)=>{x!="token"&&m.searchParams.delete(x)}),c&&m.searchParams.set("token",c)):(r&&m.searchParams.set("max_resolution",r),o&&(m.searchParams.set("min_resolution",o),r&&+r.slice(0,-1)<+o.slice(0,-1)&&console.error("minResolution must be <= maxResolution","minResolution",o,"maxResolution",r)),n&&m.searchParams.set("rendition_order",n),s&&m.searchParams.set("program_start_time",`${s}`),a&&m.searchParams.set("program_end_time",`${a}`),i&&m.searchParams.set("asset_start_time",`${i}`),l&&m.searchParams.set("asset_end_time",`${l}`),Object.entries(d).forEach(([R,x])=>{x!=null&&m.searchParams.set(R,x)})),m.toString()},re=e=>{if(!e)return;let[t]=e.split("?");return t||void 0},Me=e=>{if(!e||!e.startsWith("https://stream."))return;let[t]=new URL(e).pathname.slice(1).split(/\.m3u8|\//);return t||void 0},lr=e=>{var t,r,o;return(t=e==null?void 0:e.metadata)!=null&&t.video_id?e.metadata.video_id:Ce(e)&&(o=(r=re(e.playbackId))!=null?r:Me(e.src))!=null?o:e.src},Mt=e=>{var t;return(t=P.get(e))==null?void 0:t.error},pr=e=>{var t;return(t=P.get(e))==null?void 0:t.metadata},Ee=e=>{var t,r;return(r=(t=P.get(e))==null?void 0:t.streamType)!=null?r:_.UNKNOWN},fr=e=>{var t,r;return(r=(t=P.get(e))==null?void 0:t.targetLiveWindow)!=null?r:Number.NaN},xe=e=>{var t,r;return(r=(t=P.get(e))==null?void 0:t.seekable)!=null?r:e.seekable},Tr=e=>{var o;let t=(o=P.get(e))==null?void 0:o.liveEdgeStartOffset;if(typeof t!="number")return Number.NaN;let r=xe(e);return r.length?r.end(r.length-1)-t:Number.NaN},Re=.034,yr=(e,t,r=Re)=>Math.abs(e-t)<=r,xt=(e,t,r=Re)=>e>t||yr(e,t,r),Rt=(e,t=Re)=>e.paused&&xt(e.currentTime,e.duration,t),be=(e,t)=>{var u,c,d;if(!t||!e.buffered.length)return;if(e.readyState>2)return!1;let r=t.currentLevel>=0?(c=(u=t.levels)==null?void 0:u[t.currentLevel])==null?void 0:c.details:(d=t.levels.find(p=>!!p.details))==null?void 0:d.details;if(!r||r.live)return;let{fragments:o}=r;if(!(o!=null&&o.length))return;if(e.currentTime<e.duration-(r.targetduration+.5))return!1;let n=o[o.length-1];if(e.currentTime<=n.start)return!1;let s=n.start+n.duration/2,a=e.buffered.start(e.buffered.length-1),i=e.buffered.end(e.buffered.length-1);return s>a&&s<i},bt=(e,t)=>e.ended||e.loop?e.ended:t&&be(e,t)?!0:Rt(e),mr=(e,t,r)=>{Dt(t,r,e);let{metadata:o={}}=e,{view_session_id:n=gt()}=o,s=lr(e);o.view_session_id=n,o.video_id=s,e.metadata=o;let a=c=>{var d;(d=t.mux)==null||d.emit("hb",{view_drm_type:c})};e.drmTypeCb=a,P.set(t,{retryCount:0});let i=vt(e,t),l=He(e,t,i);e!=null&&e.muxDataKeepSession&&(t!=null&&t.mux)&&!t.mux.deleted?i&&t.mux.addHLSJS({hlsjs:i,Hls:i?E:void 0}):Nt(e,t,i),It(e,t,i),le(t),ye(t);let u=Ue(e,t,i);return{engine:i,setAutoplay:u,setPreload:l}},Dt=(e,t,r)=>{let o=t==null?void 0:t.engine;e!=null&&e.mux&&!e.mux.deleted&&(r!=null&&r.muxDataKeepSession?o&&e.mux.removeHLSJS():(e.mux.destroy(),delete e.mux)),o&&(o.detachMedia(),o.destroy()),e&&(e.hasAttribute("src")&&(e.removeAttribute("src"),e.load()),e.removeEventListener("error",St),e.removeEventListener("error",ge),e.removeEventListener("durationchange",At),P.delete(e),e.dispatchEvent(new Event("teardown")))};function Ct(e,t){var u;let r=W(e);if(!(r===N.M3U8))return!0;let n=!r||((u=t.canPlayType(r))!=null?u:!0),{preferPlayback:s}=e,a=s===j.MSE,i=s===j.NATIVE,l=Et&&(a||cr(t));return n&&(i||!l)}var vt=(e,t)=>{let{debug:r,streamType:o,startTime:n=-1,metadata:s,preferCmcd:a,_hlsConfig:i={}}=e,u=W(e)===N.M3U8,c=Ct(e,t);if(u&&!c&&Et){let d={backBufferLength:30,renderTextTracksNatively:!1,liveDurationInfinity:!0,capLevelToPlayerSize:!0,capLevelOnFPSDrop:!0},p=Pt(o),T=_t(e),m=[S.QUERY,S.HEADER].includes(a)?{useHeaders:a===S.HEADER,sessionId:s==null?void 0:s.view_session_id,contentId:s==null?void 0:s.video_id}:void 0,R=i.capLevelToPlayerSize==null?{capLevelController:Xe}:{},x=new E({debug:r,startPosition:n,cmcd:m,xhrSetup:(h,b)=>{var k,ve;if(a&&a!==S.QUERY)return;let g=new URL(b);if(!g.searchParams.has("CMCD"))return;let y=((ve=(k=g.searchParams.get("CMCD"))==null?void 0:k.split(","))!=null?ve:[]).filter(Pe=>Pe.startsWith("sid")||Pe.startsWith("cid")).join(",");g.searchParams.set("CMCD",y),h.open("GET",g)},...R,...d,...p,...T,...i});return x.on(E.Events.MANIFEST_PARSED,async function(h,b){var y,k;let g=(y=b.sessionData)==null?void 0:y["com.apple.hls.chapters"];(g!=null&&g.URI||g!=null&&g.VALUE.toLocaleLowerCase().startsWith("http"))&&te((k=g==null?void 0:g.URI)!=null?k:g==null?void 0:g.VALUE,t)}),x}},Pt=e=>e===_.LIVE?{backBufferLength:8}:{},_t=e=>{let{tokens:{drm:t}={},playbackId:r,drmTypeCb:o}=e,n=re(r);return!t||!n?{}:{emeEnabled:!0,drmSystems:{"com.apple.fps":{licenseUrl:F(e,"fairplay"),serverCertificateUrl:De(e,"fairplay")},"com.widevine.alpha":{licenseUrl:F(e,"widevine")},"com.microsoft.playready":{licenseUrl:F(e,"playready")}},requestMediaKeySystemAccessFunc:(s,a)=>(s==="com.widevine.alpha"&&(a=[...a.map(i=>{var u;let l=(u=i.videoCapabilities)==null?void 0:u.map(c=>({...c,robustness:"HW_SECURE_ALL"}));return{...i,videoCapabilities:l}}),...a]),navigator.requestMediaKeySystemAccess(s,a).then(i=>{let l=ct(s);return o==null||o(l),i}))}},kt=async e=>{let t=await fetch(e);return t.status!==200?Promise.reject(t):await t.arrayBuffer()},ht=async(e,t)=>{let r=await fetch(t,{method:"POST",headers:{"Content-type":"application/octet-stream"},body:e});if(r.status!==200)return Promise.reject(r);let o=await r.arrayBuffer();return new Uint8Array(o)},Lt=(e,t)=>{v(t,"encrypted",async o=>{try{let n=o.initDataType;if(n!=="skd"){console.error(`Received unexpected initialization data type "${n}"`);return}if(!t.mediaKeys){let u=await navigator.requestMediaKeySystemAccess("com.apple.fps",[{initDataTypes:[n],videoCapabilities:[{contentType:"application/vnd.apple.mpegurl",robustness:""}],distinctiveIdentifier:"not-allowed",persistentState:"not-allowed",sessionTypes:["temporary"]}]).then(d=>{var p;return(p=e.drmTypeCb)==null||p.call(e,ee.FAIRPLAY),d}).catch(()=>{let d=M("Cannot play DRM-protected content with current security configuration on this browser. Try playing in another browser."),p=new f(d,f.MEDIA_ERR_ENCRYPTED,!0);p.errorCategory=C.DRM,p.muxCode=D.ENCRYPTED_UNSUPPORTED_KEY_SYSTEM,I(t,p)});if(!u)return;let c=await u.createMediaKeys();try{let d=await kt(De(e,"fairplay")).catch(p=>{if(p instanceof Response){let T=Y(p,C.DRM,e);return console.error("mediaError",T==null?void 0:T.message,T==null?void 0:T.context),T?Promise.reject(T):Promise.reject(new Error("Unexpected error in app cert request"))}return Promise.reject(p)});await c.setServerCertificate(d).catch(()=>{let p=M("Your server certificate failed when attempting to set it. This may be an issue with a no longer valid certificate."),T=new f(p,f.MEDIA_ERR_ENCRYPTED,!0);return T.errorCategory=C.DRM,T.muxCode=D.ENCRYPTED_UPDATE_SERVER_CERT_FAILED,Promise.reject(T)})}catch(d){I(t,d);return}await t.setMediaKeys(c)}let s=o.initData;if(s==null){console.error(`Could not start encrypted playback due to missing initData in ${o.type} event`);return}let a=t.mediaKeys.createSession();a.addEventListener("keystatuseschange",()=>{a.keyStatuses.forEach(u=>{let c;if(u==="internal-error"){let d=M("The DRM Content Decryption Module system had an internal failure. Try reloading the page, upading your browser, or playing in another browser.");c=new f(d,f.MEDIA_ERR_ENCRYPTED,!0),c.errorCategory=C.DRM,c.muxCode=D.ENCRYPTED_CDM_ERROR}else if(u==="output-restricted"||u==="output-downscaled"){let d=M("DRM playback is being attempted in an environment that is not sufficiently secure. User may see black screen.");c=new f(d,f.MEDIA_ERR_ENCRYPTED,!1),c.errorCategory=C.DRM,c.muxCode=D.ENCRYPTED_OUTPUT_RESTRICTED}c&&I(t,c)})});let i=await Promise.all([a.generateRequest(n,s).catch(()=>{let u=M("Failed to generate a DRM license request. This may be an issue with the player or your protected content."),c=new f(u,f.MEDIA_ERR_ENCRYPTED,!0);c.errorCategory=C.DRM,c.muxCode=D.ENCRYPTED_GENERATE_REQUEST_FAILED,I(t,c)}),new Promise(u=>{a.addEventListener("message",c=>{u(c.message)},{once:!0})})]).then(([,u])=>u),l=await ht(i,F(e,"fairplay")).catch(u=>{if(u instanceof Response){let c=Y(u,C.DRM,e);return console.error("mediaError",c==null?void 0:c.message,c==null?void 0:c.context),c?Promise.reject(c):Promise.reject(new Error("Unexpected error in license key request"))}return Promise.reject(u)});await a.update(l).catch(()=>{let u=M("Failed to update DRM license. This may be an issue with the player or your protected content."),c=new f(u,f.MEDIA_ERR_ENCRYPTED,!0);return c.errorCategory=C.DRM,c.muxCode=D.ENCRYPTED_UPDATE_LICENSE_FAILED,Promise.reject(c)})}catch(n){I(t,n);return}})},F=({playbackId:e,tokens:{drm:t}={},customDomain:r=A},o)=>{let n=re(e);return`https://license.${r.toLocaleLowerCase().endsWith(A)?r:A}/license/${o}/${n}?token=${t}`},De=({playbackId:e,tokens:{drm:t}={},customDomain:r=A},o)=>{let n=re(e);return`https://license.${r.toLocaleLowerCase().endsWith(A)?r:A}/appcert/${o}/${n}?token=${t}`},Ce=({playbackId:e,src:t,customDomain:r})=>{if(e)return!0;if(typeof t!="string")return!1;let o=window==null?void 0:window.location.href,n=new URL(t,o).hostname.toLocaleLowerCase();return n.includes(A)||!!r&&n.includes(r.toLocaleLowerCase())},Nt=(e,t,r)=>{var l;let{envKey:o,disableTracking:n,muxDataSDK:s=$.default,muxDataSDKOptions:a={}}=e,i=Ce(e);if(!n&&(o||i)){let{playerInitTime:u,playerSoftwareName:c,playerSoftwareVersion:d,beaconCollectionDomain:p,debug:T,disableCookies:m}=e,R={...e.metadata,video_title:((l=e==null?void 0:e.metadata)==null?void 0:l.video_title)||void 0},x=h=>typeof h.player_error_code=="string"?!1:typeof e.errorTranslator=="function"?e.errorTranslator(h):h;s.monitor(t,{debug:T,beaconCollectionDomain:p,hlsjs:r,Hls:r?E:void 0,automaticErrorTracking:!1,errorTranslator:x,disableCookies:m,...a,data:{...o?{env_key:o}:{},player_software_name:c,player_software:c,player_software_version:d,player_init_time:u,...R}})}},It=(e,t,r)=>{var c,d;let o=Ct(e,t),{src:n,customDomain:s=A}=e,a=()=>{t.ended||e.disablePseudoEnded||!bt(t,r)||(be(t,r)?t.currentTime=t.buffered.end(t.buffered.length-1):t.dispatchEvent(new Event("ended")))},i,l,u=()=>{let p=xe(t),T,m;p.length>0&&(T=p.start(0),m=p.end(0)),(l!==m||i!==T)&&t.dispatchEvent(new CustomEvent("seekablechange",{composed:!0})),i=T,l=m};if(v(t,"durationchange",u),t&&o){let p=W(e);if(typeof n=="string"){if(n.endsWith(".mp4")&&n.includes(s)){let R=Me(n),x=new URL(`https://stream.${s}/${R}/metadata.json`);te(x.toString(),t)}let T=()=>{if(Ee(t)!==_.LIVE||Number.isFinite(t.duration))return;let R=setInterval(u,1e3);t.addEventListener("teardown",()=>{clearInterval(R)},{once:!0}),v(t,"durationchange",()=>{Number.isFinite(t.duration)&&clearInterval(R)})},m=async()=>Tt(n,t,p).then(T).catch(R=>{if(R instanceof Response){let x=Y(R,C.VIDEO,e);if(x){I(t,x);return}}else R instanceof Error});if(t.preload==="none"){let R=()=>{m(),t.removeEventListener("loadedmetadata",x)},x=()=>{m(),t.removeEventListener("play",R)};v(t,"play",R,{once:!0}),v(t,"loadedmetadata",x,{once:!0})}else m();(c=e.tokens)!=null&&c.drm?Lt(e,t):v(t,"encrypted",()=>{let R=M("Attempting to play DRM-protected content without providing a DRM token."),x=new f(R,f.MEDIA_ERR_ENCRYPTED,!0);x.errorCategory=C.DRM,x.muxCode=D.ENCRYPTED_MISSING_TOKEN,I(t,x)},{once:!0}),t.setAttribute("src",n),e.startTime&&(((d=P.get(t))!=null?d:{}).startTime=e.startTime,t.addEventListener("durationchange",At,{once:!0}))}else t.removeAttribute("src");t.addEventListener("error",St),t.addEventListener("error",ge),t.addEventListener("emptied",()=>{t.querySelectorAll("track[data-removeondestroy]").forEach(m=>{m.remove()})},{once:!0}),v(t,"pause",a),v(t,"seeked",a),v(t,"play",()=>{t.ended||xt(t.currentTime,t.duration)&&(t.currentTime=t.seekable.length?t.seekable.start(0):0)})}else r&&n?(r.once(E.Events.LEVEL_LOADED,(p,T)=>{mt(T.details,t,r),u(),Ee(t)===_.LIVE&&!Number.isFinite(t.duration)&&(r.on(E.Events.LEVEL_UPDATED,u),v(t,"durationchange",()=>{Number.isFinite(t.duration)&&r.off(E.Events.LEVELS_UPDATED,u)}))}),r.on(E.Events.ERROR,(p,T)=>{var R,x;let m=Er(T,e);if(m.muxCode===D.NETWORK_NOT_READY){let b=(R=P.get(t))!=null?R:{},g=(x=b.retryCount)!=null?x:0;if(g<6){let y=g===0?5e3:6e4,k=new f(`Retrying in ${y/1e3} seconds...`,m.code,m.fatal);Object.assign(k,m),I(t,k),setTimeout(()=>{b.retryCount=g+1,T.details==="manifestLoadError"&&T.url&&r.loadSource(T.url)},y);return}else{b.retryCount=0;let y=new f('Try again later or <a href="#" onclick="window.location.reload(); return false;" style="color: #4a90e2;">click here to retry</a>',m.code,m.fatal);Object.assign(y,m),I(t,y);return}}I(t,m)}),r.on(E.Events.MANIFEST_LOADED,()=>{let p=P.get(t);p&&p.error&&(p.error=null,p.retryCount=0,t.dispatchEvent(new Event("emptied")),t.dispatchEvent(new Event("loadstart")))}),t.addEventListener("error",ge),v(t,"waiting",a),Ve(e,r),Ke(t,r),r.attachMedia(t)):console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")};function At(e){var o;let t=e.target,r=(o=P.get(t))==null?void 0:o.startTime;if(r&&Le(t.seekable,t.duration,r)){let n=t.preload==="auto";n&&(t.preload="none"),t.currentTime=r,n&&(t.preload="auto")}}async function St(e){if(!e.isTrusted)return;e.stopImmediatePropagation();let t=e.target;if(!(t!=null&&t.error))return;let{message:r,code:o}=t.error,n=new f(r,o);if(t.src&&o===f.MEDIA_ERR_SRC_NOT_SUPPORTED&&t.readyState===HTMLMediaElement.HAVE_NOTHING){setTimeout(()=>{var a;let s=(a=Mt(t))!=null?a:t.error;(s==null?void 0:s.code)===f.MEDIA_ERR_SRC_NOT_SUPPORTED&&I(t,n)},500);return}if(t.src&&(o!==f.MEDIA_ERR_DECODE||o!==void 0))try{let{status:s}=await fetch(t.src);n.data={response:{code:s}}}catch{}I(t,n)}function I(e,t){var r;t.fatal&&(((r=P.get(e))!=null?r:{}).error=t,e.dispatchEvent(new CustomEvent("error",{detail:t})))}function ge(e){var o,n;if(!(e instanceof CustomEvent)||!(e.detail instanceof f))return;let t=e.target,r=e.detail;!r||!r.fatal||(((o=P.get(t))!=null?o:{}).error=r,(n=t.mux)==null||n.emit("error",{player_error_code:r.code,player_error_message:r.message,player_error_context:r.context}))}var Er=(e,t)=>{var l,u,c;!e.fatal?t.debug&&console.warn("getErrorFromHlsErrorData() (non-fatal)",e):console.error("getErrorFromHlsErrorData()",e);let o={[E.ErrorTypes.NETWORK_ERROR]:f.MEDIA_ERR_NETWORK,[E.ErrorTypes.MEDIA_ERROR]:f.MEDIA_ERR_DECODE,[E.ErrorTypes.KEY_SYSTEM_ERROR]:f.MEDIA_ERR_ENCRYPTED},n=d=>[E.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,E.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED].includes(d.details)?f.MEDIA_ERR_NETWORK:o[d.type],s=d=>{if(d.type===E.ErrorTypes.KEY_SYSTEM_ERROR)return C.DRM;if(d.type===E.ErrorTypes.NETWORK_ERROR)return C.VIDEO},a,i=n(e);if(i===f.MEDIA_ERR_NETWORK&&e.response){let d=(l=s(e))!=null?l:C.VIDEO;a=(u=Y(e.response,d,t,e.fatal))!=null?u:new f("",i,e.fatal)}else if(i===f.MEDIA_ERR_ENCRYPTED)if(e.details===E.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE){let d=M("Attempting to play DRM-protected content without providing a DRM token.");a=new f(d,f.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=C.DRM,a.muxCode=D.ENCRYPTED_MISSING_TOKEN}else if(e.details===E.ErrorDetails.KEY_SYSTEM_NO_ACCESS){let d=M("Cannot play DRM-protected content with current security configuration on this browser. Try playing in another browser.");a=new f(d,f.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=C.DRM,a.muxCode=D.ENCRYPTED_UNSUPPORTED_KEY_SYSTEM}else if(e.details===E.ErrorDetails.KEY_SYSTEM_NO_SESSION){let d=M("Failed to generate a DRM license request. This may be an issue with the player or your protected content.");a=new f(d,f.MEDIA_ERR_ENCRYPTED,!0),a.errorCategory=C.DRM,a.muxCode=D.ENCRYPTED_GENERATE_REQUEST_FAILED}else if(e.details===E.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED){let d=M("Failed to update DRM license. This may be an issue with the player or your protected content.");a=new f(d,f.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=C.DRM,a.muxCode=D.ENCRYPTED_UPDATE_LICENSE_FAILED}else if(e.details===E.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED){let d=M("Your server certificate failed when attempting to set it. This may be an issue with a no longer valid certificate.");a=new f(d,f.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=C.DRM,a.muxCode=D.ENCRYPTED_UPDATE_SERVER_CERT_FAILED}else if(e.details===E.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR){let d=M("The DRM Content Decryption Module system had an internal failure. Try reloading the page, upading your browser, or playing in another browser.");a=new f(d,f.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=C.DRM,a.muxCode=D.ENCRYPTED_CDM_ERROR}else if(e.details===E.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED){let d=M("DRM playback is being attempted in an environment that is not sufficiently secure. User may see black screen.");a=new f(d,f.MEDIA_ERR_ENCRYPTED,!1),a.errorCategory=C.DRM,a.muxCode=D.ENCRYPTED_OUTPUT_RESTRICTED}else a=new f(e.error.message,f.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=C.DRM,a.muxCode=D.ENCRYPTED_ERROR;else a=new f("",i,e.fatal);return a.context||(a.context=`${e.url?`url: ${e.url}
`:""}${e.response&&(e.response.code||e.response.text)?`response: ${e.response.code}, ${e.response.text}
`:""}${e.reason?`failure reason: ${e.reason}
`:""}${e.level?`level: ${e.level}
`:""}${e.parent?`parent stream controller: ${e.parent}
`:""}${e.buffer?`buffer length: ${e.buffer}
`:""}${e.error?`error: ${e.error}
`:""}${e.event?`event: ${e.event}
`:""}${e.err?`error message: ${(c=e.err)==null?void 0:c.message}
`:""}`),a.data=e,a};
//# sourceMappingURL=index.cjs.js.map
